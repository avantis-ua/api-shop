var db,templates_lib="/themes/lib",api_shop="/themes/app",indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction,IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange,request=indexedDB.open("apiShop",1);request.onupgradeneeded=function(e){(db=e.target.result).createObjectStore("languages",{keyPath:"id"}),db.createObjectStore("user",{keyPath:"id"})};var localDb=window.localStorage,sessionDb=window.sessionStorage;function storageAvailable(e){try{var t=window[e],a="__storage_test__";return t.setItem(a,a),t.removeItem(a),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==t.length}}function setDb(e,t){storageAvailable("localStorage")&&localDb.setItem(e,t),storageAvailable("sessionStorage")&&sessionDb.setItem(e,t)}function getDb(e){return storageAvailable("localStorage")?localDb.getItem(e):storageAvailable("sessionStorage")?sessionDb.getItem(e):null}function removeDb(e){return storageAvailable("localStorage")?(localDb.removeItem(e),!0):storageAvailable("sessionStorage")?(sessionDb.removeItem(e),!0):null}function clearDb(){try{return localDb.clear(),sessionDb.clear(),!0}catch(e){return null}}function createCookie(e,t,a){if(a){var n=new Date;n.setTime(n.getTime()+24*a*60*60*365);var o="; expires="+n.toGMTString()}else o="";document.cookie=e+"="+t+o+"; path=/"}function readCookie(e){for(var t=e+"=",a=document.cookie.split(";"),n=0;n<a.length;n++){for(var o=a[n];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return null}function eraseCookie(e){createCookie(e,"",-1)}function isValidJSON(e){var t=e;return t=(t=(t=t.replace(/\\["\\\/bfnrtu]/g,"@")).replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]")).replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(t)}function OneNotify(e,t,a,n,o){new PNotify({title:e,text:t,type:a,icon:n,addclass:o})}function jsonNotify(e){new PNotify(e)}var languages=new Object;function lang(e){return $.grep(languages,function(t){return t.id==e})[0].name}function getLanguages(){try{if(null!=getDb("languages")){var e=getDb("languages");return JSON&&JSON.parse(e)||$.parseJSON(e)}setDb("lang",2),$.post(post_id+router_language,{id:2},function(e){var t=JSON&&JSON.parse(e)||$.parseJSON(e);if(200==t.status){setDb("languages",JSON.stringify(t.languages));var a=getDb("languages");return JSON&&JSON.parse(a)||$.parseJSON(a)}})}catch(e){$.get(post_id+router_language,{},function(e){var t=JSON&&JSON.parse(e)||$.parseJSON(e);if(200==t.status)return t.languages})}}function setLanguage(e){setDb("lang",e),$.post(post_id+router_language,{id:e},function(e){var t=JSON&&JSON.parse(e)||$.parseJSON(e);if(200==t.status)try{setDb("languages",JSON.stringify(t.languages)),window.location.reload()}catch(e){window.location.reload()}else 400==t.status&&OneNotify(t.title,t.text,t.color)})}function checkIn(){$(".error_message").remove(),checkPhone("phone",lang(200),!1),checkPassword("password",lang(201),password_expression),checkEmail("email",lang(161),email_expression),checkData("fname",lang(57),word_expression),checkData("iname",lang(58),word_expression);var e=$("#phone").intlTelInput("getNumber"),t=$("#email").val(),a=$("#password").val(),n=$("#iname").val(),o=$("#fname").val(),r=$("#csrf").val();setDb("phone",e),setDb("email",t),setDb("iname",n),setDb("fname",o),$.post(post_id+router_check_in,{email:t,phone:e,password:a,iname:n,fname:o,csrf:r},function(e){var t=$.parseJSON(e);200==t.status?window.location="/":400==t.status&&OneNotify(t.title,t.text,t.color)})}function login(){$(".error_message").remove(),checkPhone("phone",lang(200),!1),checkPassword("password",lang(201),password_expression),checkEmail("email",lang(161),email_expression);var e=$("#phone").intlTelInput("getNumber"),t=$("#email").val(),a=$("#password").val(),n=$("#csrf").val();setDb("phone",e),setDb("email",t),$.post(post_id+router_login,{email:t,phone:e,password:a,csrf:n},function(e){var t=$.parseJSON(e);200==t.status?window.location="/":400==t.status&&OneNotify(t.title,t.text,t.color)})}function logout(){var e=$("#csrf").val();$.post(post_id+router_logout,{csrf:e},function(e){var t=$.parseJSON(e);200==t.status?window.location="/":400==t.status&&OneNotify(t.title,t.text,t.color)})}function newOrder(e){var t=$("#product_id-"+e).val(),a=$("#num-"+e).val(),n=$("#price-"+e).val(),o=$("#iname-"+e).val(),r=$("#fname-"+e).val(),s=$("#phone-"+e).val(),i=$("#email-"+e).val(),l=$("#city_name-"+e).val(),c=$("#street-"+e).val(),u=$("#build-"+e).val(),g=$("#apart-"+e).val(),d=$("#description-"+e).val(),p=$("#csrf").val();$.post(post_id+router_cart+"new-order",{csrf:p,id:e,product_id:t,num:a,price:n,iname:o,fname:r,phone:s,email:i,city_name:l,street:c,build:u,apart:g,description:d},function(t){var a=$.parseJSON(t);200==a.status?$("#ok-"+e).html(a.title):400==a.status&&OneNotify(a.title,a.text,a.color)})}function addToCart(e){var t=$("#product_id-"+e).val(),a=$("#num-"+e).val(),n=$("#price-"+e).val(),o=$("#csrf").val();$.post(post_id+router_cart+"add-to-cart",{csrf:o,id:e,product_id:t,num:a,price:n},function(e){var t=$.parseJSON(e);200==t.status?OneNotify(t.title,t.text,t.color):400==t.status&&OneNotify(t.title,t.text,t.color)})}languages=getLanguages();